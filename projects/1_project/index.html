<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> PlanYourMeals.com | James Vance, ML Engineer </title> <meta name="author" content="James D. Vance"> <meta name="description" content="A full stack, science-based meal planning webapp"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jamesdvance.github.io/projects/1_project/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> James Vance, ML Engineer </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">side projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">PlanYourMeals.com</h1> <p class="post-description">A full stack, science-based meal planning webapp</p> </header> <article> <h1 id="planyoumeals-2017---2020">PlanYouMeals (2017 - 2020)</h1> <p>PlanYourMeals was a passion project that grew out of a frustration with existing calorie trackers like MyFitnessPal and the automatic meal planner EatThisMuch. Like so many people, my early efforts going to gym were limited until that realization that diet is 80% of success. The bottom line? Muscles grow much easier in the precesnse of a caloric surplus and fat only disappears in the precense of a deficit. Working out with controlling eating leads to a lot of effort with marginly noticeable results.</p> <p>Originally, I used MyFitnessPal to track calories, but could rarely get a perfect macro fit. Often, I’d find myself out of ideas while trying to find a source of protein for dinner after ‘spending’ too many carbs and fats at breakfast and lunch. I nexted tried EatThisMuch, a programatic meal planner that combined different recipes to make a macro-optimized daily plan. Although I had paid for the pro version and spent time setting up a menu, the plans I got back were always frustrating - for example, three different dishes for breakfast, each involving prep and cook. Then, a preparead lunch (who has time?) and a vegetable dish as a ‘snack’.</p> <p>The first feature I implemented was the ability to solve a single day &lt;div class="col-sm mt-3 mt-md-0"&gt;</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/planyourmeals/single_day_solve_reframed-480.webp 480w,/assets/img/planyourmeals/single_day_solve_reframed-800.webp 800w,/assets/img/planyourmeals/single_day_solve_reframed-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/planyourmeals/single_day_solve_reframed.gif" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;/div&gt;
</code></pre></div></div> <p>Yes, I learned and implement React with Redux for state management, drag-and-drop in react.</p> <p>My concept for planyourmeals was a planner that would be able to create plans that adapted to how I might actually during the day, using my frequent meals and snacks most frequently, and that would allow me to make mid-day changes, for example if I no longer had time to cook and wanted to go to Chipotle instead.</p> <h3 id="the-core-model">The Core Model</h3> <p>I first built an optimization model that would assign integer amounts of realistic serving sizes per food item. The following code sets up a Pyomo modeling object with the following problem. To see how this is implemented in code, see Apendix 1.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Objective Function
min⁡∑i∈I∑d∈D∑m∈Mpi⋅yi,d,m\min \sum_{i \in I} \sum_{d \in D} \sum_{m \in M} p_i \cdot y_{i,d,m}min∑i∈I​∑d∈D​∑m∈M​pi​⋅yi,d,m​
Constraints
1. Required Meals
∑i∈Iyi,d,m≥requiredm∀d∈D,m∈M\sum_{i \in I} y_{i,d,m} \geq required_m \quad \forall d \in D, m \in M∑i∈I​yi,d,m​≥requiredm​∀d∈D,m∈M
2. Serving Amount Bounds
0≤xi,d,m≤max_servingsi⋅yi,d,m∀i∈I,d∈D,m∈M0 \leq x_{i,d,m} \leq max\_servings_i \cdot y_{i,d,m} \quad \forall i \in I, d \in D, m \in M0≤xi,d,m​≤max_servingsi​⋅yi,d,m​∀i∈I,d∈D,m∈M
3. Big M Constraint (Binary Variable Linkage)
xi,d,m≤M⋅yi,d,m∀i∈I,d∈D,m∈Mx_{i,d,m} \leq M \cdot y_{i,d,m} \quad \forall i \in I, d \in D, m \in Mxi,d,m​≤M⋅yi,d,m​∀i∈I,d∈D,m∈M
4. Maximum Items per Meal
∑i∈Iyi,d,m≤max_itemsm∀d∈D,m∈M\sum_{i \in I} y_{i,d,m} \leq max\_items_m \quad \forall d \in D, m \in M∑i∈I​yi,d,m​≤max_itemsm​∀d∈D,m∈M
5. No Food Repetition Across Days
∑d∈D∑m∈Myi,d,m≤1∀i∈I\sum_{d \in D} \sum_{m \in M} y_{i,d,m} \leq 1 \quad \forall i \in I∑d∈D​∑m∈M​yi,d,m​≤1∀i∈I
6. Food Class Disjunction
For each food class $c$, if any food from that class is assigned to a meal, then the meal must be "committed" to that class:
yi,d,m≤zd,m,c∀i∈I,d∈D,m∈M,c∈C:classi,c=1y_{i,d,m} \leq z_{d,m,c} \quad \forall i \in I, d \in D, m \in M, c \in C : class_{i,c} = 1yi,d,m​≤zd,m,c​∀i∈I,d∈D,m∈M,c∈C:classi,c​=1
∑i∈I:classi,c=1yi,d,m≥zd,m,c∀d∈D,m∈M,c∈C\sum_{i \in I : class_{i,c} = 1} y_{i,d,m} \geq z_{d,m,c} \quad \forall d \in D, m \in M, c \in C∑i∈I:classi,c​=1​yi,d,m​≥zd,m,c​∀d∈D,m∈M,c∈C
7. Variable Domains

$x_{i,d,m} \geq 0$ (continuous)
$y_{i,d,m} \in {0, 1}$ (binary)
$z_{d,m,c} \in {0, 1}$ (binary)
</code></pre></div></div> <ol> <li> </ol> <p>Disclaimer: this code was written from 2017 - 2018 and I may not make the same choices today. See <a href="https://github.com/jamesdvance/planyourmealsapi/blob/master/autoplanner/autoplan_week.py#L423" rel="external nofollow noopener" target="_blank">full code here</a></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		<span class="n">has_dj</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="c1"># Model Create and Index
</span>		<span class="n">model</span> <span class="o">=</span> <span class="nc">ConcreteModel</span><span class="p">()</span>
		<span class="c1"># Indices
</span>		<span class="n">access_df</span> <span class="o">=</span> <span class="n">food_df</span><span class="p">[[</span><span class="sh">'</span><span class="s">access_idx</span><span class="sh">'</span><span class="p">]]</span>
		<span class="n">full_I_dict</span> <span class="o">=</span> <span class="n">access_df</span><span class="p">[</span><span class="sh">'</span><span class="s">access_idx</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_dict</span><span class="p">()</span>
		<span class="n">access_df</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">access_df</span><span class="p">[</span><span class="sh">'</span><span class="s">access_idx</span><span class="sh">'</span><span class="p">]</span>
		<span class="n">access_df</span> <span class="o">=</span> <span class="n">access_df</span><span class="p">.</span><span class="nf">assign</span><span class="p">(</span><span class="n">full_I</span><span class="o">=</span><span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">access_df</span><span class="p">)))</span>
		<span class="n">access_dict</span> <span class="o">=</span> <span class="n">access_df</span><span class="p">[</span><span class="sh">'</span><span class="s">full_I</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_dict</span><span class="p">()</span>
		<span class="n">model</span><span class="p">.</span><span class="n">access_idx</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">access_df</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
		<span class="n">model</span><span class="p">.</span><span class="n">full_I</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># used for objective function only
</span>		<span class="c1"># Params
</span>		<span class="n">model</span><span class="p">.</span><span class="n">access_idx_lkup</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">access_idx</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">access_dict</span><span class="p">)</span> <span class="c1"># To lookup the i based on the access_idx
</span>		<span class="n">model</span><span class="p">.</span><span class="n">full_I_lkup</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">full_I</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">full_I_dict</span><span class="p">)</span> <span class="c1"># To lookup the access_idx based on the i. For parsing solves
</span>		<span class="c1"># Sub-indeces of Full_I
</span>		<span class="c1"># Going to loop through meal_idx_tup and use setattr
</span>		<span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">meals_idx_tup</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">incl_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">]</span> <span class="ow">and</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">Snack</span><span class="sh">'</span><span class="p">:</span>
				<span class="c1"># Setting individual index
</span>				<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])].</span><span class="n">index</span><span class="p">))</span>
				<span class="k">if</span> <span class="n">src_constr_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">sa</span><span class="sh">'</span><span class="p">:</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_wm</span><span class="sh">"</span><span class="p">,</span><span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                          <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                         <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">dish_num</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">Whole Meals</span><span class="sh">'</span><span class="p">)].</span><span class="n">index</span><span class="p">))</span>
				<span class="k">elif</span> <span class="n">src_constr_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">bd</span><span class="sh">'</span><span class="p">:</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_mc</span><span class="sh">"</span><span class="p">,</span><span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                          <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                         <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">dish_num</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">Main Courses</span><span class="sh">'</span><span class="p">)].</span><span class="n">index</span><span class="p">))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_si</span><span class="sh">"</span><span class="p">,</span><span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                          <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                         <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">dish_num</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">Sides</span><span class="sh">'</span><span class="p">)].</span><span class="n">index</span><span class="p">))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_wm</span><span class="sh">"</span><span class="p">,</span><span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                          <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                         <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">dish_num</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">Whole Meals</span><span class="sh">'</span><span class="p">)].</span><span class="n">index</span><span class="p">))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_mc</span><span class="sh">"</span><span class="p">,</span><span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                          <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                         <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">dish_num</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">Main Courses</span><span class="sh">'</span><span class="p">)].</span><span class="n">index</span><span class="p">))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_si</span><span class="sh">"</span><span class="p">,</span><span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                          <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                         <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">dish_num</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">Sides</span><span class="sh">'</span><span class="p">)].</span><span class="n">index</span><span class="p">))</span>
			<span class="k">elif</span> <span class="n">incl_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">]</span> <span class="ow">and</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">Snack</span><span class="sh">'</span><span class="p">:</span>
				<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span>\
		                                                                <span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])].</span><span class="n">index</span><span class="p">))</span>
		<span class="sh">"""</span><span class="s">
		Model Params
		</span><span class="sh">"""</span>
		<span class="n">model</span><span class="p">.</span><span class="n">amt_ub</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">full_I</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[[</span><span class="sh">'</span><span class="s">max_servings</span><span class="sh">'</span><span class="p">]].</span><span class="nf">to_dict</span><span class="p">(</span><span class="sh">'</span><span class="s">dict</span><span class="sh">'</span><span class="p">)[</span><span class="sh">'</span><span class="s">max_servings</span><span class="sh">'</span><span class="p">])</span>
		<span class="sh">"""</span><span class="s">
		Creating Variables
		</span><span class="sh">"""</span>
		<span class="n">model</span><span class="p">.</span><span class="n">ind</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">full_I</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">Binary</span><span class="p">)</span>
		<span class="n">model</span><span class="p">.</span><span class="n">amt</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">full_I</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">NonNegativeIntegers</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">food_max</span><span class="p">))</span>
		<span class="c1"># Creating Constraints
</span>		<span class="c1"># Set A Global Big M constraint so that ind is tied to amt
</span>		<span class="k">def</span> <span class="nf">m</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">model</span><span class="p">.</span><span class="n">amt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">global_m</span>
		<span class="k">def</span> <span class="nf">use_ind</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="p">.</span><span class="n">amt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

		<span class="n">model</span><span class="p">.</span><span class="n">m_items</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">full_I</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
		<span class="n">model</span><span class="p">.</span><span class="n">use_m</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">full_I</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">use_ind</span><span class="p">)</span>

		<span class="sh">"""</span><span class="s">
		Don</span><span class="sh">'</span><span class="s">t repeat accross days
		</span><span class="sh">"""</span>
		<span class="c1">#for tup in meal_food_tup.itertuples():
</span>		<span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">meal_food_tup</span><span class="p">:</span>
			<span class="sh">"""</span><span class="s">
			Does not include meals
			</span><span class="sh">"""</span>
			<span class="c1"># print(tup)
</span>			<span class="c1"># idx = food_df[(food_df['fd_type']=='food')&amp;(food_df['unique_id']==tup[1])].index
</span>			<span class="c1"># setattr(model, str(tup[1])+"_non_rep", Constraint(expr=sum([model.ind[m] for m in idx])&lt;=tup[2])) # Sets all to '2' which is highly infeasible
</span>
			<span class="n">idx</span> <span class="o">=</span> <span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">fd_type</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">unique_id</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">tup</span><span class="p">[</span><span class="mi">2</span><span class="p">])].</span><span class="n">index</span>
			<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="sh">"</span><span class="s">_non_rep</span><span class="sh">"</span><span class="p">,</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">])</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">))</span> 
		
		<span class="sh">"""</span><span class="s">
		Disjunction
		</span><span class="sh">"""</span>
		<span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">meals_idx_tup</span><span class="p">:</span> <span class="c1"># Can combine with above loop after getting this down
</span>			<span class="k">if</span> <span class="n">incl_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">]</span> <span class="ow">and</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">Snack</span><span class="sh">'</span><span class="p">:</span>        
				<span class="k">if</span> <span class="n">src_constr_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">sa</span><span class="sh">'</span><span class="p">:</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_wm</span><span class="sh">"</span><span class="p">,</span> 
						<span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_wm</span><span class="sh">"</span><span class="p">)])</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>
				<span class="k">elif</span> <span class="n">src_constr_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">bd</span><span class="sh">'</span><span class="p">:</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_mc</span><span class="sh">"</span><span class="p">,</span> 
						<span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_mc</span><span class="sh">"</span><span class="p">)])</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_si</span><span class="sh">"</span><span class="p">,</span> 
						<span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">inequality</span><span class="p">(</span><span class="n">sides_dict</span><span class="p">[</span><span class="sh">'</span><span class="s">br</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">],</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
		                                                                                    <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_si</span><span class="sh">"</span><span class="p">)]))))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_sa</span><span class="sh">"</span><span class="p">,</span> 
						<span class="nc">Disjunct</span><span class="p">())</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_sa</span><span class="sh">"</span><span class="p">),</span><span class="sh">'</span><span class="s">c1</span><span class="sh">'</span><span class="p">,</span> 
						<span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_wm</span><span class="sh">"</span><span class="p">)])</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_sa</span><span class="sh">"</span><span class="p">)</span> <span class="p">,</span><span class="sh">'</span><span class="s">c2</span><span class="sh">'</span><span class="p">,</span>
						<span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_mc</span><span class="sh">"</span><span class="p">)</span> <span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_sa</span><span class="sh">"</span><span class="p">),</span><span class="sh">'</span><span class="s">c3</span><span class="sh">'</span><span class="p">,</span>
						<span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_si</span><span class="sh">"</span><span class="p">)</span> <span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_bd</span><span class="sh">"</span><span class="p">,</span> 
						<span class="nc">Disjunct</span><span class="p">())</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_bd</span><span class="sh">"</span><span class="p">),</span><span class="sh">'</span><span class="s">c1</span><span class="sh">'</span><span class="p">,</span>
						<span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_wm</span><span class="sh">"</span><span class="p">)</span> <span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_bd</span><span class="sh">"</span><span class="p">),</span><span class="sh">'</span><span class="s">c2</span><span class="sh">'</span><span class="p">,</span>
						<span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_mc</span><span class="sh">"</span><span class="p">)</span> <span class="p">])</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_bd</span><span class="sh">"</span><span class="p">),</span><span class="sh">'</span><span class="s">c3</span><span class="sh">'</span><span class="p">,</span>
						<span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">inequality</span><span class="p">(</span><span class="n">sides_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">],</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> 
						<span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_si</span><span class="sh">"</span> <span class="p">)]),</span><span class="n">sides_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">])))</span>
					<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">,</span><span class="nc">Disjunction</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="p">[</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_sa</span><span class="sh">"</span> <span class="p">),</span> 
						<span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_sel_bd</span><span class="sh">"</span><span class="p">)]))</span>
					<span class="n">has_dj</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">elif</span> <span class="n">incl_dict</span><span class="p">[</span><span class="n">tup</span><span class="p">]</span> <span class="ow">and</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">Snack</span><span class="sh">'</span><span class="p">:</span>
				<span class="c1"># Snack Amount Constraints
</span>				<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_ind_n</span><span class="sh">"</span><span class="p">,</span><span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">ind</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
					<span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="o">+</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span><span class="o">&lt;=</span><span class="n">n_snack</span><span class="p">)</span> <span class="p">)</span>
		<span class="c1"># Disjunctive Transformation
</span>		<span class="k">if</span> <span class="n">has_dj</span><span class="p">:</span>
			<span class="n">trnsfrm</span> <span class="o">=</span> <span class="nc">TransformationFactory</span><span class="p">(</span><span class="sh">'</span><span class="s">gdp.bigm</span><span class="sh">'</span><span class="p">)</span> <span class="c1"># Toggle chull bigm
</span>			<span class="n">trnsfrm</span><span class="p">.</span><span class="nf">apply_to</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

		<span class="c1"># Amount max
</span>		<span class="k">def</span> <span class="nf">amt_bounds</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">model</span><span class="p">.</span><span class="n">amt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="p">.</span><span class="n">amt_ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">model</span><span class="p">.</span><span class="n">amt_bounds</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">full_I</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">amt_bounds</span><span class="p">)</span>
		<span class="c1"># Nutritional bounds  
</span>		<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">days</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">leftover_dict</span><span class="p">:</span>
				<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_index</span><span class="sh">"</span><span class="p">,</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">day</span><span class="p">)</span><span class="o">|</span>\
					<span class="p">((</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">leftover_dict</span><span class="p">[</span><span class="n">day</span><span class="p">][</span><span class="sh">'</span><span class="s">orig_day</span><span class="sh">'</span><span class="p">])</span><span class="o">&amp;</span>\
					<span class="p">(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">meal</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">leftover_dict</span><span class="p">[</span><span class="n">day</span><span class="p">][</span><span class="sh">'</span><span class="s">orig_meal</span><span class="sh">'</span><span class="p">]))].</span><span class="n">index</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_index</span><span class="sh">"</span><span class="p">,</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">food_df</span><span class="p">[(</span><span class="n">food_df</span><span class="p">[</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="n">day</span><span class="p">)].</span><span class="n">index</span><span class="p">))</span>
			<span class="c1"># Will need to also change food_df_dict going forward for different days that already have something planned
</span>			<span class="c1"># Set Index N
</span>			<span class="n">nutrient_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">requirements_dict</span><span class="p">[</span><span class="n">day</span><span class="p">])</span>
			<span class="n">nut_cols</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">nutrient_df</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
			<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_N</span><span class="sh">"</span><span class="p">,</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">nut_cols</span><span class="p">))</span> 
			<span class="n">food_df_dict</span> <span class="o">=</span> <span class="n">food_df</span><span class="p">[[</span><span class="sh">'</span><span class="s">prob_r</span><span class="sh">'</span><span class="p">]</span><span class="o">+</span><span class="n">nut_cols</span><span class="p">].</span><span class="nf">to_dict</span><span class="p">(</span><span class="sh">'</span><span class="s">list</span><span class="sh">'</span><span class="p">)</span>
			<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_bounds</span><span class="sh">"</span><span class="p">,</span> <span class="nc">Param</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_N</span><span class="sh">"</span><span class="p">),</span> <span class="n">initialize</span><span class="o">=</span><span class="n">nutrient_df</span><span class="p">[</span><span class="n">nut_cols</span><span class="p">].</span><span class="nf">to_dict</span><span class="p">(</span><span class="sh">'</span><span class="s">list</span><span class="sh">'</span><span class="p">)))</span> 
			
			<span class="k">def</span> <span class="nf">ml_bounds</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
				<span class="nf">return </span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_bounds</span><span class="sh">"</span><span class="p">)[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nf">sum</span><span class="p">([</span><span class="n">food_df_dict</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span> <span class="n">model</span><span class="p">.</span><span class="n">amt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_index</span><span class="sh">"</span><span class="p">)]),</span> 
					<span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_bounds</span><span class="sh">"</span><span class="p">)[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
			<span class="nf">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_nutr_bounds</span><span class="sh">"</span><span class="p">,</span> <span class="nc">Constraint</span><span class="p">(</span><span class="nf">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">day</span><span class="o">+</span><span class="sh">"</span><span class="s">_N</span><span class="sh">"</span><span class="p">),</span> <span class="n">rule</span><span class="o">=</span><span class="n">ml_bounds</span><span class="p">))</span>

		<span class="c1"># Objective
</span>		<span class="k">def</span> <span class="nf">tgt_obj</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
			<span class="k">return</span>  <span class="nf">sum_product</span><span class="p">(</span><span class="n">food_df_dict</span><span class="p">[</span><span class="sh">'</span><span class="s">prob_r</span><span class="sh">'</span><span class="p">],</span> <span class="n">model</span><span class="p">.</span><span class="n">amt</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">model</span><span class="p">.</span><span class="n">full_I</span><span class="p">)</span>
		<span class="n">model</span><span class="p">.</span><span class="n">obj</span> <span class="o">=</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">tgt_obj</span><span class="p">)</span>
</code></pre></div></div> <p>This led to a</p> <h2 id="learnings">Learnings</h2> <h3 id="skills">Skills</h3> <ol> <li>Pyomo, CBC, Branch-and-Cut Optimization methods</li> <li>Django, Postgresql</li> <li>React, Redux and State</li> <li>Celery and asyncronous workflows</li> <li>Nginx, gunicorn, and Linux hosting (etcd, port management, etc)</li> <li>AWS Cloud (EC2, S3, CodeBuild, CodePipeline, VPC’s, Subnets, RDS, etc)</li> </ol> <h3 id="project-level">Project-Level</h3> <ol> <li>Appreciation for Frontend</li> </ol> <p>The experience of understanding React modules, the choices for managing state, and how bottlenecked the entire flow was by the frontend was an eye-opening experience and a</p> <ol> <li> <p>Data model choices anchor your project, are hard to change</p> </li> <li> <p>Data Categories, Tags and Labels are Crucial</p> </li> <li> <p>Data Science Proejcts are Continuous</p> </li> </ol> <p>Within months of building my POC, I had a backlog of data science-based tasks. Semantic similarity between serving size descriptions. Named entity recognition to parse free text descriptions into ingredient unit, amount and serving size. K-nearest neighbors for similar-nutrient profile recommendations. Image classification or similar search to identify incorrect item thumbnails.</p> <ol> <li>Good Software Is Not a One-Person Job I wanted to upskill my data science by finding</li> </ol> <h2 id="conclusion">Conclusion</h2> <p>This project evolved from a desire to dig deeper into Optimization into a part-time obsession with making the best meal planning project. In the end, there wasn’t much of a clamouring for a hyper-precise adpable meal planner. With the arrival of my first daughter, and a new job during the Covid-19 pandemic I decided to simplify my life and step back from the project, investing the additional energy into my full-time job.</p> <p>I’m happy with that decision, but still proud of the work and the learnings along the way.</p> <h1 id="appendix">Appendix</h1> <h2 id="faqs">FAQ’s</h2> <p><strong>Why is the code all added to github at once?</strong></p> <p>While the code originally was pushed to github, in 2017 I switched to AWS CodeCommit for greater security and CICD integration with AWS native tools. In 2025,</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 James D. Vance. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>